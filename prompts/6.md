# Prompt 6: E2E Testing & Bug Fixes

**Priority:** P0 (Critical)
**Focus:** Testing / Quality Assurance
**Skill Required:** Load `move-dev` skill for contract testing

---

## Pre-Flight Checklist

1. **Read ALL issues:** Check every `docs/issues/*/README.md` file
2. **Ensure previous prompts completed:**
   - UserScreen.tsx decomposed (< 300 lines)
   - Deep links working
   - Pyth worker running (optional)
   - Bonus system deployed
   - Error handling in place

---

## Context

Before MVP launch, we need comprehensive E2E testing of the entire flow:
1. Onboarding → Login → Browse → Bet → Claim
2. All screens render correctly
3. All transactions succeed
4. Edge cases don't crash the app

---

## Requirements

### 1. Test Matrix

Execute each test case and document results:

#### Onboarding Flow
| # | Test Case | Steps | Expected | Result |
|---|-----------|-------|----------|--------|
| 1.1 | Fresh install onboarding | Clear app data, open app | Tutorial screens show | ⬜ |
| 1.2 | Complete tutorial | Swipe through all steps | Login screen appears | ⬜ |
| 1.3 | Skip tutorial | Tap skip | Login screen appears | ⬜ |
| 1.4 | Tutorial doesn't repeat | Complete tutorial, kill app, reopen | Goes directly to login | ⬜ |

#### Authentication
| # | Test Case | Steps | Expected | Result |
|---|-----------|-------|----------|--------|
| 2.1 | Email login | Enter email, verify code | Logged in, wallet created | ⬜ |
| 2.2 | Google login | Tap Google button | OAuth flow, logged in | ⬜ |
| 2.3 | Logout | Go to profile, tap logout | Returns to login | ⬜ |
| 2.4 | Session persistence | Login, kill app, reopen | Still logged in | ⬜ |

#### Feed & Markets
| # | Test Case | Steps | Expected | Result |
|---|-----------|-------|----------|--------|
| 3.1 | Markets load | Open feed tab | Markets display | ⬜ |
| 3.2 | Card swipe left | Swipe card left | Bet modal (NO) | ⬜ |
| 3.3 | Card swipe right | Swipe card right | Bet modal (YES) | ⬜ |
| 3.4 | Skip card | Tap skip button | Next card shows | ⬜ |
| 3.5 | Empty markets | No markets exist | Empty state shows | ⬜ |
| 3.6 | Pull to refresh | Pull down on feed | Markets refresh | ⬜ |

#### Betting
| # | Test Case | Steps | Expected | Result |
|---|-----------|-------|----------|--------|
| 4.1 | Place minimum bet | Enter $0.10, confirm | Transaction succeeds | ⬜ |
| 4.2 | Place maximum bet | Enter $10, confirm | Transaction succeeds | ⬜ |
| 4.3 | Bet below minimum | Enter $0.05 | Error: "Minimum $0.10" | ⬜ |
| 4.4 | Bet above maximum | Enter $15 | Error or capped at $10 | ⬜ |
| 4.5 | Insufficient balance | Bet more than balance | Error: "Insufficient" | ⬜ |
| 4.6 | Use bonus | New user, place bet | Bonus applied | ⬜ |

#### My Bets
| # | Test Case | Steps | Expected | Result |
|---|-----------|-------|----------|--------|
| 5.1 | View active bets | Go to My Bets tab | Active positions show | ⬜ |
| 5.2 | View won bets | After market resolves | Won section populated | ⬜ |
| 5.3 | View lost bets | After losing bet | Lost section populated | ⬜ |
| 5.4 | Claim single win | Tap claim on position | Winnings received | ⬜ |
| 5.5 | Claim all wins | Tap "Claim All" banner | All winnings received | ⬜ |
| 5.6 | Empty positions | No bets placed | Empty state shows | ⬜ |

#### Profile
| # | Test Case | Steps | Expected | Result |
|---|-----------|-------|----------|--------|
| 6.1 | Stats display | Go to profile | Win rate, bets shown | ⬜ |
| 6.2 | Balance display | Check balance | Correct balance shown | ⬜ |
| 6.3 | Leaderboard | Scroll to leaderboard | Rankings display | ⬜ |
| 6.4 | Referral code | Find referral section | Code displayed | ⬜ |
| 6.5 | Share referral | Tap share | Share sheet opens | ⬜ |

#### Deep Links
| # | Test Case | Steps | Expected | Result |
|---|-----------|-------|----------|--------|
| 7.1 | Market link | Open pulse://market/1 | Market highlighted | ⬜ |
| 7.2 | Referral link | Open pulse://ref/CODE | Code saved | ⬜ |
| 7.3 | Bets link | Open pulse://bets | My Bets tab opens | ⬜ |
| 7.4 | Invalid link | Open pulse://invalid | Graceful handling | ⬜ |

### 2. Bug Tracking

Create/update `docs/bugs.md` for any issues found:

```markdown
# Bug: [Brief description]
**Severity:** Critical/High/Medium/Low
**Screen:** [Screen name]
**Steps to reproduce:**
1. ...
2. ...
**Expected:** ...
**Actual:** ...
**Screenshot:** [if applicable]
```

### 3. Fix Critical Bugs

For any Critical or High severity bugs:
1. Identify root cause
2. Implement fix
3. Verify fix
4. Update test result to ✅

### 4. Performance Check

| Metric | Target | Actual |
|--------|--------|--------|
| App cold start | < 3 seconds | ⬜ |
| Feed load time | < 2 seconds | ⬜ |
| Bet transaction | < 5 seconds | ⬜ |
| Claim transaction | < 5 seconds | ⬜ |
| Memory usage (idle) | < 200 MB | ⬜ |

---

## Implementation Steps

1. **Set up test environment** - Fresh testnet wallet, funded
2. **Execute test matrix** - Go through each case
3. **Document failures** - In docs/bugs.md
4. **Fix critical issues** - Prioritize blockers
5. **Re-test fixed items** - Verify resolution
6. **Performance testing** - Check timing/memory
7. **Final pass** - Smoke test full flow

---

## Verification

All test cases should show ✅:
```
✅ 1.1 Fresh install onboarding
✅ 1.2 Complete tutorial
... etc
```

No Critical or High bugs remain open.

---

## Do NOT

- Skip test cases
- Mark tests as passed without actually testing
- Leave Critical bugs unfixed
- Ignore intermittent failures (investigate them)
- Test only happy paths

---

## Deliverables

1. Completed test matrix with all results
2. `docs/bugs.md` with any issues found
3. All Critical/High bugs fixed
4. Performance metrics documented
5. Clean smoke test of full user journey

---

## Post-Completion

1. Document testing learnings in appropriate `docs/issues/*/README.md`
2. Keep `docs/bugs.md` for tracking remaining issues
3. Delete this prompt file: `rm prompts/6.md`
4. Report: "completed prompt 6" with summary of bugs found/fixed
